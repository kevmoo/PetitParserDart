        <!DOCTYPE html>
        <html>
        <head>
                <meta charset="utf-8">
        <title>Natives class / lisp Library / Dart Documentation</title>
        <link rel="stylesheet" type="text/css"
            href="../styles.css">
        <link href="//fonts.googleapis.com/css?family=Open+Sans:400,600,700,800" rel="stylesheet" type="text/css">
        <link rel="shortcut icon" href="../favicon.ico">
        
        </head>
        <body data-library="lisp" data-type="Natives">
        <div class="page">
        <div class="header">
          <a href="../index.html"><div class="logo"></div></a>
          <a href="../index.html">Dart Documentation</a>
         &rsaquo; <a href="../lisp.html">lisp</a> &rsaquo; <a href="../lisp/Natives.html">Natives</a>        <div id="search-box">
          <input type="search" name="q" id="q" autocomplete="off"
              class="search-input" placeholder="Search API">
        </div>
        
      </div>
      <div class="drop-down" id="drop-down"></div>
      
        <div class="nav">
        
</div>
<div class="content">
        <h2><strong>Natives</strong>
          class
        </h2>
        
<button id="show-inherited" class="show-inherited">Hide inherited</button>
<div class="doc">
<p>Collection of native functions.</p>
<pre class="source">
class Natives {

 static Map&lt;String, dynamic&gt; _natives;

 /** Looks a native function up. */
 static dynamic find(String name) {
   _initialize();
   return _natives[name];
 }

 /** Imports all the native functions into the [environment]. */
 static Environment importNatives(Environment env) {
   _initialize();
   _natives.forEach((key, value) {
     env.define(new Name(key), value);
   });
   return env;
 }

 /** Imports the standard library into the [envoronment]. */
 static Environment importStandard(Environment env) {
   evalString(new LispParser(), env, _standardLibrary);
   return env;
 }

 /** A simple standard library, should be moved to external file. */
 static String _standardLibrary = """
; Copyright (c) 2013, Lukas Renggli &lt;renggli@gmail.com&gt;

; null functions
(define null '())
(define (null? x) (= '() x))

; list functions
(define (length list)
 (if (null? list)
     0
     (+ 1 (length (cdr list)))))

(define (append list1 list2)
 (if (null? list1)
   list2
   (cons (car list1) (append (cdr list1) list2))))

(define (list-head list index)
 (if (= index 0)
   (car list)
   (list-head
     (cdr list)
     (- index 1))))

(define (list-tail list index)
 (if (= index 0)
   (cdr list)
   (list-tail
     (cdr list)
     (- index 1))))

(define (for-each list proc)
 (while (not (null? list))
   (proc (car list))
   (set! list (cdr list))))

(define (map list proc)
 (if (null? list)
   '()
   (cons (proc (car list))
         (map (cdr list) proc))))

(define (inject list value proc)
 (if (null? list)
   value
   (inject
     (cdr list)
     (proc value (car list))
     proc)))
""";

 static void _initialize() {
   if (_natives == null) {
     _natives = new Map();
     _basicFunctions();
     _controlStructures();
     _arithmeticMethods();
     _arithmeticComparators();
     _listOperators();
   }
 }

 static void _basicFunctions() {
   _natives['define'] = (Environment env, dynamic args) {
     if (args.head is Name) {
       return env.define(args.head, evalList(env, args.tail));
     } else if (args.head.head is Name) {
       return env.define(args.head.head, _natives['lambda'](env,
           new Cons(args.head.tail, args.tail)));
     } else {
       throw new ArgumentError('Invalid define: $args');
     }
   };
   _natives['lambda'] = (Environment lambda_env, dynamic lambda_args) {
     return (Environment env, dynamic args) {
       var inner = lambda_env.create();
       var names = lambda_args.head;
       var values = evalArguments(env, args);
       while (names != null &amp;&amp; values != null) {
         inner.define(names.head, values.head);
         names = names.tail;
         values = values.tail;
       }
       return evalList(inner, lambda_args.tail);
     };
   };
   _natives['quote'] = (Environment env, dynamic args) {
     return args;
   };
   _natives['eval'] = (Environment env, dynamic args) {
     return eval(env.create(), eval(env, args.head));
   };
   _natives['apply'] = (Environment env, dynamic args) {
     return eval(env, args.head)(env.create(), args.tail);
   };
   _natives['let'] = (Environment env, dynamic args) {
     var inner = env.create();
     var binding = args.head;
     while (binding != null) {
       inner.define(binding.head.head, eval(env, binding.head.tail.head));
       binding = binding.tail;
     }
     return evalList(inner, args.tail);
   };
   _natives['set!'] = (Environment env, dynamic args) {
     return env[args.head] = eval(env, args.tail.head);
   };
   _natives['print'] = (Environment env, dynamic args) {
     var buffer = new StringBuffer();
     while (args != null) {
       buffer.write(eval(env, args.head));
       args = args.tail;
     }
     print(buffer.toString());
     return null;
   };
 }

 static void _controlStructures() {
   _natives['if'] = (Environment env, dynamic args) {
     var condition = eval(env, args.head);
     if (condition) {
       if (args.tail != null) {
         return eval(env, args.tail.head);
       }
     } else {
       if (args.tail != null &amp;&amp; args.tail.tail != null) {
         return eval(env, args.tail.tail.head);
       }
     }
     return null;
   };
   _natives['while'] = (Environment env, dynamic args) {
     var result = null;
     while (eval(env, args.head)) {
       result = evalList(env, args.tail);
     }
     return result;
   };
   _natives['true'] = true;
   _natives['false'] = false;
   _natives['and'] = (Environment env, dynamic args) {
     while (args != null) {
       if (!eval(env, args.head)) {
         return false;
       }
       args = args.tail;
     }
     return true;
   };
   _natives['or'] = (Environment env, dynamic args) {
     while (args != null) {
       if (eval(env, args.head)) {
         return true;
       }
       args = args.tail;
     }
     return false;
   };
   _natives['not'] = (Environment env, dynamic args) {
     return !eval(env, args.head);
   };
 }

 static void _arithmeticMethods() {
   _natives['+'] = (Environment env, dynamic args) {
     var value = eval(env, args.head);
     for (args = args.tail; args != null; args = args.tail) {
       value += eval(env, args.head);
     }
     return value;
   };
   _natives['-'] = (Environment env, dynamic args) {
     var value = eval(env, args.head);
     if (args.tail == null) {
       return -value;
     }
     for (args = args.tail; args != null; args = args.tail) {
       value -= eval(env, args.head);
     }
     return value;
   };
   _natives['*'] = (Environment env, dynamic args) {
     var value = eval(env, args.head);
     for (args = args.tail; args != null; args = args.tail) {
       value *= eval(env, args.head);
     }
     return value;
   };
   _natives['/'] = (Environment env, dynamic args) {
     var value = eval(env, args.head);
     for (args = args.tail; args != null; args = args.tail) {
       value /= eval(env, args.head);
     }
     return value;
   };
   _natives['%'] = (Environment env, dynamic args) {
     var value = eval(env, args.head);
     for (args = args.tail; args != null; args = args.tail) {
       value %= eval(env, args.head);
     }
     return value;
   };
 }

 static void _arithmeticComparators() {
   _natives['&lt;'] = (Environment env, dynamic args) {
     return eval(env, args.head) &lt; eval(env, args.tail.head);
   };
   _natives['&lt;='] = (Environment env, dynamic args) {
     return eval(env, args.head) &lt;= eval(env, args.tail.head);
   };
   _natives['='] = (Environment env, dynamic args) {
     return eval(env, args.head) == eval(env, args.tail.head);
   };
   _natives['!='] = (Environment env, dynamic args) {
     return eval(env, args.head) != eval(env, args.tail.head);
   };
   _natives['&gt;'] = (Environment env, dynamic args) {
     return eval(env, args.head) &gt; eval(env, args.tail.head);
   };
   _natives['&gt;='] = (Environment env, dynamic args) {
     return eval(env, args.head) &gt;= eval(env, args.tail.head);
   };
 }

 static void _listOperators() {
   _natives['cons'] = (Environment env, dynamic args) {
     return new Cons(eval(env, args.head), eval(env, args.tail.head));
   };
   _natives['car'] = (Environment env, dynamic args) {
     var cons = eval(env, args.head);
     return cons is Cons ? cons.head : null;
   };
   _natives['car!'] = (Environment env, dynamic args) {
     var cons = eval(env, args.head);
     if (cons is Cons) {
       cons.head = eval(env, args.tail.head);
     }
     return cons;
   };
   _natives['cdr'] = (Environment env, dynamic args) {
     var cons = eval(env, args.head);
     return cons is Cons ? cons.tail : null;
   };
   _natives['cdr!'] = (Environment env, dynamic args) {
     var cons = eval(env, args.head);
     if (cons is Cons) {
       cons.tail = eval(env, args.tail.head);
     }
     return cons;
   };
 }

}
</pre>
</div>
<div>
<h3>Static Methods</h3>
<div class="method"><h4 id="find">
<button class="show-code">Code</button>
dynamic <strong>find</strong>(<a href="http://api.dartlang.org/dart_core/String.html">String</a> name) <a class="anchor-link" href="#find"
              title="Permalink to Natives.find">#</a></h4>
<div class="doc">
<p>Looks a native function up. </p>
<pre class="source">
static dynamic find(String name) {
 _initialize();
 return _natives[name];
}
</pre>
</div>
</div>
<div class="method"><h4 id="importNatives">
<button class="show-code">Code</button>
<a href="../lisp/Environment.html">Environment</a> <strong>importNatives</strong>(<a href="../lisp/Environment.html">Environment</a> env) <a class="anchor-link" href="#importNatives"
              title="Permalink to Natives.importNatives">#</a></h4>
<div class="doc">
<p>Imports all the native functions into the <code>environment</code>. </p>
<pre class="source">
static Environment importNatives(Environment env) {
 _initialize();
 _natives.forEach((key, value) {
   env.define(new Name(key), value);
 });
 return env;
}
</pre>
</div>
</div>
<div class="method"><h4 id="importStandard">
<button class="show-code">Code</button>
<a href="../lisp/Environment.html">Environment</a> <strong>importStandard</strong>(<a href="../lisp/Environment.html">Environment</a> env) <a class="anchor-link" href="#importStandard"
              title="Permalink to Natives.importStandard">#</a></h4>
<div class="doc">
<p>Imports the standard library into the <code>envoronment</code>. </p>
<pre class="source">
static Environment importStandard(Environment env) {
 evalString(new LispParser(), env, _standardLibrary);
 return env;
}
</pre>
</div>
</div>
</div>
        </div>
        <div class="clear"></div>
        </div>
        <div class="footer">
          
        </div>
        <script async src="../client-live-nav.js"></script>
        </body></html>
        
